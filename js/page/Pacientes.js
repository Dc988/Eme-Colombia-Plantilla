// const //TBL TIPO ID

let data = {
    "1": {
        "id_form": "1",
        "Tipo_ID_FK": "4",
        "IDENTIFICACION": "123456789",
        "Apellido_1": "Gómez",
        "Apellido_2": "Pérez",
        "Nombre_1": "Carlos",
        "Nombre_2": "Andrés",
        "Fecha_Na": "1990-05-15",
        "Edad": "34",
        "tipo_pac_FK": "2",
        "Sexo": "M",
        "Direccion": "Calle 45 #12-34",
        "Barrio": "Centro",
        "Telefono": "3001234567",
        "Celular": "3209876543",
        "Estado_Civil_FK": "1",
        "Ocupacion_FK": "3",
        "Aseguradora_FK": "2",
        "Colaborador_FK": "5",
        "MES_ACCIDENTE": "03",
        "Tipo_ingreso_FK": "1",
        "Triage": "II",
        "Fecha_Ingreso": "2025-03-08",
        "Hora_Ingreso": "14:30",
        "Fecha_evento": "2025-03-07",
        "Hora_evento": "13:15",
        "Departamento": "Atlántico",
        "Municipio_fk": "1",
        "Direccion_evento": "Avenida 80 #10-20",
        "Marca": "Toyota",
        "Tipo_Vehiculo": "Carro",
        "Placa": "ABC123",
        "apellido_prop_vehiculo": "Martínez",
        "Nombre_prop_vehiculo": "Luis",
        "Poliza": "POL12345",
        "Identificacion_prop_vehiculo": "987654321",
        "Id_2": "2",
        "Tipo_ID_FK_2": "2",
        "IDENTIFICACION_2": "1122334455",
        "Apellido_1_2": "Ramírez",
        "Apellido_2_2": "López",
        "Nombre_1_2": "Ana",
        "Nombre_2_2": "María",
        "Fecha_Na_2": "1985-08-22",
        "Edad_2": "39",
        "tipo_pac_FK_2": "1",
        "Sexo_2": "F",
        "Direccion_2": "Carrera 50 #23-45",
        "Barrio_2": "Poblado",
        "Telefono_2": "3104567890",
        "Celular_2": "3159876543"
    },
    "2": {
        "id_form": "2",
        "Tipo_ID_FK": "4",
        "IDENTIFICACION": "987654321",
        "Apellido_1": "Fernández",
        "Apellido_2": "Torres",
        "Nombre_1": "Juan",
        "Nombre_2": "Pablo",
        "Fecha_Na": "1987-12-10",
        "Edad": "37",
        "tipo_pac_FK": "1",
        "Sexo": "M",
        "Direccion": "Calle 12 #5-67",
        "Barrio": "San Javier",
        "Telefono": "3012233445",
        "Celular": "3119988776",
        "Estado_Civil_FK": "2",
        "Ocupacion_FK": "4",
        "Aseguradora_FK": "3",
        "Colaborador_FK": "6",
        "MES_ACCIDENTE": "02",
        "Tipo_ingreso_FK": "2",
        "Triage": "I",
        "Fecha_Ingreso": "2025-03-06",
        "Hora_Ingreso": "08:45",
        "Fecha_evento": "2025-03-05",
        "Hora_evento": "19:30",
        "Departamento": "Atlántico",
        "Municipio_fk": "3",
        "Direccion_evento": "Calle 26 #15-30",
        "Marca": "Honda",
        "Tipo_Vehiculo": "Moto",
        "Placa": "XYZ987",
        "apellido_prop_vehiculo": "Gutiérrez",
        "Nombre_prop_vehiculo": "Laura",
        "Poliza": "POL67890",
        "Identificacion_prop_vehiculo": "2233445566",
        "Id_2": "3",
        "Tipo_ID_FK_2": "1",
        "IDENTIFICACION_2": "5566778899",
        "Apellido_1_2": "Mendoza",
        "Apellido_2_2": "Vargas",
        "Nombre_1_2": "Sofía",
        "Nombre_2_2": "Elena",
        "Fecha_Na_2": "1992-04-05",
        "Edad_2": "33",
        "tipo_pac_FK_2": "2",
        "Sexo_2": "F",
        "Direccion_2": "Carrera 8 #17-89",
        "Barrio_2": "Chapinero",
        "Telefono_2": "3123344556",
        "Celular_2": "3174455667"
    },
    "3": {
        "id_form": "3",
        "Tipo_ID_FK": "4",
        "IDENTIFICACION": "555111222",
        "Apellido_1": "López",
        "Apellido_2": "García",
        "Nombre_1": "Mariana",
        "Nombre_2": "Isabel",
        "Fecha_Na": "1995-06-30",
        "Edad": "29",
        "tipo_pac_FK": "2",
        "Sexo": "F",
        "Direccion": "Calle 78 #9-56",
        "Barrio": "Laureles",
        "Telefono": "3021122334",
        "Celular": "3135566778",
        "Estado_Civil_FK": "3",
        "Ocupacion_FK": "5",
        "Aseguradora_FK": "4",
        "Colaborador_FK": "7",
        "MES_ACCIDENTE": "01",
        "Tipo_ingreso_FK": "1",
        "Triage": "I",
        "Fecha_Ingreso": "2025-02-28",
        "Hora_Ingreso": "10:15",
        "Fecha_evento": "2025-02-27",
        "Hora_evento": "21:50",
        "Departamento": "Atlántico",
        "Municipio_fk": "5",
        "Direccion_evento": "Avenida Roosevelt #14-23",
        "Marca": "Chevrolet",
        "Tipo_Vehiculo": "Carro",
        "Placa": "JKL456",
        "apellido_prop_vehiculo": "Rodríguez",
        "Nombre_prop_vehiculo": "Camilo",
        "Poliza": "POL45678",
        "Identificacion_prop_vehiculo": "9988776655",
        "Id_2": "4",
        "Tipo_ID_FK_2": "2",
        "IDENTIFICACION_2": "6677889900",
        "Apellido_1_2": "Ortega",
        "Apellido_2_2": "Suárez",
        "Nombre_1_2": "Daniel",
        "Nombre_2_2": "Alejandro",
        "Fecha_Na_2": "1989-11-15",
        "Edad_2": "35",
        "tipo_pac_FK_2": "1",
        "Sexo_2": "M",
        "Direccion_2": "Carrera 15 #22-11",
        "Barrio_2": "Versalles",
        "Telefono_2": "3142233445",
        "Celular_2": "3183344556"
    }
}


tbl_pacientes = createDataTable('#tbl_Pacientes',
    "/Paciente/list",
    [{ 'data': 'id' },
    { 'data': 'IDENTIFICACION' },
    { 'data': 'Nombre_Completo' },
    //          { 'data': 'Fecha_Ingreso' },
    { 'data': 'acciones' },
    ]);

if (typeof frmPaciente !== "undefined") {


    var typingTimer; // Temporizado

    Fecha_Na.setAttribute("target", "Edad");
    Fecha_Na.addEventListener("change", (event) => { calcEdad(event) });

    Fecha_Na_2.setAttribute("target", "Edad_2");
    Fecha_Na_2.addEventListener("change", (event) => { calcEdad(event) });
}

function btnPacienteViewData_onclick(id) {

    show_tap_panel("Panel_Paciente_Data_View");
}

function calcEdad(e) {

    txt_fecha_na = e.target;
    txt_edad = document.getElementById(e.target.getAttribute("target"));


    fechaNacimiento = new Date(txt_fecha_na.value);
    fechaActual = new Date();

    edad = fechaActual.getFullYear() - fechaNacimiento.getFullYear();


    if (fechaNacimiento.getMonth() > fechaActual.getMonth() || (fechaNacimiento.getMonth() === fechaActual.getMonth() && fechaNacimiento.getDate() > fechaActual.getDate())) {
        edad--;
    }

    if (edad > 0 && edad <= 110) {
        txt_fecha_na.classList.remove("is-invalid");
        setInputErrorMsg(txt_fecha_na, "Campo Requerido!!");
        txt_edad.value = edad;
    } else {

        txt_fecha_na.classList.add("is-invalid");
        setInputErrorMsg(txt_fecha_na, "Fecha no es valida!!");
        txt_edad.value = "";
    }

}

function validate_form_section(id) {
    var band = true;

    document.getElementById(id).querySelectorAll("input, select").forEach(item => {

        if (item.value == "") {
            item.classList.add("is-invalid");

            band = false;
        } else {
            item.classList.remove("is-invalid");
        }

    });

    return band;
}

function go_to_panel_2_onclick() {
    if (validate_form_section("Panel_1")) {
        show_tap_panel("Panel_2");
    }
}

function go_to_panel_3_onclick() {
    if (validate_form_section("Panel_2")) {
        MES_ACCIDENTE.value = "1";
        show_tap_panel("Panel_3");

    }
}

function go_to_panel_4_onclick() {
    if (validate_form_section("Panel_3")) {
        if (Id_2.value == "") {
            Id_2.value = id_form.value;
            IDENTIFICACION_2.value = IDENTIFICACION.value;
            Apellido_1_2.value = Apellido_1.value;
            Apellido_2_2.value = Apellido_2.value;
            Nombre_1_2.value = Nombre_1.value;
            Nombre_2_2.value = Nombre_2.value;
            Fecha_Na_2.value = Fecha_Na.value;
            Direccion_2.value = Direccion.value;
            Telefono_2.value = Telefono.value;
            Celular_2.value = Celular.value;
            Edad_2.value = Edad.value;
            Sexo_2.value = Sexo.value;
            Barrio_2.value = Barrio.value;
            Tipo_ID_FK_2.value = Tipo_ID_FK.value;
            tipo_pac_FK_2.value = tipo_pac_FK.value;
        }

        show_tap_panel("Panel_4");
    }
}

function DataPaciente_onclick() {


    if (frmPaciente.checkValidity()) {
        switch (btn_submit_form.textContent) {
            case "Registrar":
                save_paciente_data();
                break;
            case "Editar":
                //edit_paciente_data();
                break;

            default:
                alertas('Error en el componente submit', 'warning');
        }
    } else {
        alertas("Oops, Hay Campos abligatorios", "warning");
    }
}

function save_paciente_data() {
    confirmationAlert("Desea Guardar la información?", "", "info").then((result) => {
        if (result.isConfirmed) {
            animation_load();

            /*let row = {};
            id_form.value = (Object.keys(data).length + 1)
            const items_form = frmPaciente.querySelectorAll("input, select");

            items_form.forEach(item => {
                row[item.id] = item.value;
            });

            data[id_form.value] = row;

            addDataTable();*/

            alertas("Datos Guardados!", "success");
            window.location = "../pacientes.html";
            remove_animation_load();

        }
    });
}

function edit_paciente_data() {

    confirmationAlert("Desea editar la información?", "", "info").then((result) => {
        if (result.isConfirmed) {


        }
    });
}



function addDataTable() {

    Object.entries(data).forEach(([key, row]) => {
        var nuevaFila = {
            id: row.id_form,
            IDENTIFICACION: row.IDENTIFICACION,
            Nombre_Completo: `${row.Apellido_1} ${row.Apellido_2} ${row.Nombre_1} ${row.Nombre_2} `,
            acciones: `<a href ="pacientes/paciente_view_data.html" class="btn btn-success btn-sm" onclick="btnPacienteViewData_onclick(${row.id_form});"><i class="fa fa-eye"></i></a>`
        };

        tbl_pacientes.row.add(nuevaFila).draw();

    });



    // Agregar la fila a la tabla y redibujarla

}


addDataTable();

$(function () {
    $(".panel-body").niceScroll(sidebar_nicescroll_opts);
});


id_paciente.innerHTML = "1";
nombre_paciente.innerHTML = "Fernández Torres Juan Pablo";
edad_paciente.innerHTML = "29";
fecha_nacimiento_paciente.innerHTML = "29/12/1986";
estado_civil_paciente.innerHTML = "SOLTERO";
identificacion_paciente.innerHTML = "22569986";
telefono_paciente.innerHTML = "N/A";
celular_paciente.innerHTML = "3022563652";
ocupacion_paciente.innerHTML = "AMA DE CASA";
sexo_paciente.innerHTML = "F";
direccion_paciente.innerHTML = "CALLE 2 SUR 1 256";
barrio_paciente.innerHTML = "LAS FLORES";




















